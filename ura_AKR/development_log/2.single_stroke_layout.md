# 実際の配列を決めていく

さて、裏 AKR 配列に関する大まかな方向性が定まり、配列を決めるときの鍵となるような N-gram のデータも揃った。ようやく配列を決めていくことにする。

### 最も重要な３つの文字

uni-gram のデータを見ると、(新下駄配列でもそうであったように) `い`、`う`、`ん` の三文字が圧倒的に多く出現しているのが分かる (次は `し` だが、頻度で言えば `ん` の 7 割程度だ)。

ところで私は `ゃゅょ` という拗音文字の入力にそれぞれ `/ss/`、`/ll/`、`/l;/` を使おうと考えている。つまり `[き]ょう` や `[じ]ゅう` という文字列を打つ場合、アルペジオ的なことを考えると、`う` は右手側にある方が望ましいということになる。

これら３つの文字は、当然単打面の一番打ちやすい場所に配置されるが、bi-gram データを見ると、`うい` が `いう` よりも大分多く現れている。これって私の直感に大分反している気がする。bi-gram の元データを見ると「じゅういち」や「にじゅういち」というデータを見かける。なるほどこれらが合わさって `うい` に重みがついているのか。そして `い` から始まる bi-gram と `う` から始まるそれを比較すると、後者のほうが少しだけ頻繁にあるように見える。ここは私の個人的な直感を優先させて `いう` の方が優勢であるとして

* 確定: `/j/` => `う`
* 確定: `/k/` => `い`
* 確定: `/f/` => `ん`

とする (つまり新下駄配列と同じである)。

それから `ん` であるが、`/f/` ではなくて `/r/` でも良いのではないかと迷いはした (文頭や文節の最初には来ない文字のため)。しかし `ん` が中に来る単語も多いため (`かんがえ` や `さんじゅう` など)、`/f/` が良いだろうと判断した。

### bi-gram / tri-gram を使った考察

今の所確定しているのは `う`、`い`、`ん` の三文字しかないのだが、この辺で早速 tri-gram を見ていくことにする。これら三文字に関しては拗音文字が周りにあるパターンが多いのだけれど、それ以外にも `せ`、`じ`、`し` が近くにある。bi-gram の中身を見ると、`せ`、`こ`、`か`、`て` がある。まずは uni-gram でも順位の高い `し` と `か` を考える。

`しん` という流れは目立つがそれ以外は `[いうん]し` というパターンが多いように見える。一方 `か` に関してはこれら三文字の前にも後にも来るパターンが多いという印象。これらのことから

* 確定: `/d/` => `か`
* 確定: `/e/` => `し`

としていく。

次に `せ` について考えていく。`う|い` は既に右手単打面のホームポジションにあるため、間に入る `せ` も単打面が良いということになるが、`せ` は uni-gram 的には 30 番目にある文字である。これらのことから `せ` は「それだけだと打ちにくい位置だけど、`[うい]` との組み合わせとしては打ちやすい場所」に配置されるべきであろう(今のところの個人的な感覚は `/z/` か `/x/` か `/p/` なのだけれどまだ決定的ではない)。

* 未確定: `/[zxp]/` => `せ`

`の` もランクは高いのだけれど、新下駄配列 (とその考え方) に倣って `/a/` に置くことにする。

* 確定: `/a/` => `の`

現状決まったのは以下の通り:

```
__ __ し __ __      __ __ __ __ __
の シ か ん __      __ う い シ シ
__ __ __ __ __      __ __ __ __ __
```

`の` を無理やり決定してしまったので、ついでに `る` についても考える。周りに `。` が出てくる (ということは、文の最後に来やすい) 文字である。他にも `する` や `いる` `くる` があるが、`る` で始まる bi-gram はランクがあまり高くない (`ると` ぐらいかな)。外側から内側下部への流れを考えると、これは `/v/` が妥当だと考える。`。` だがこちらは `/./` が妥当だと考える。`[たるい]。` という流れがあるが、この位置なら流れを損なうことも無いだろうという考え。

* 確定: `/v/` => `る`
* 確定: `/./` => `。`

ちなみに `た` は uni-gram ランク 9 である。ここは `たい` のアルペジオを意識して `/o/` か `/n/` に配置するのが妥当だと考えるが、`。` のことも考えて `/n/` に配置する (`た。` はアルペジオで表現したい上にキーボードによっては `/m/` だと `/k/` とのアルペジオがタイトすぎることがある)。

* 確定: `/n/` => `た`

...この辺で一々自分の思考を文にするのが疲れてきた。上のようなことを考えながら、bi-gram と tri-gram の並びを見て、以下のように決定していく。

* `と` => ランク 7。`ん_と_う - い_と_う - と_い_う - う_と_う` の流れが上には入っている。本来ならば新下駄配列のように `/s/` に配置したいところだが、それはシフトキーなので `/w/` が妥当であると考える。
    * 確定: `/w/` => `と`
* `こ` => ランク 16。`ん_こ_う - う_こ_う - い_こ_う` の流れが上には入っている。4-gram を見てみると `(け|か|じ|し|さ|へ)_ん_こ_う` が上位にある。bi-gram では `こ_い` というのがあまり上位になかったので、`/i/` に配置。
    * 確定: `/i/` => `こ`
* `が` => ランク 18。`う_が_い - い_が_い` の流れが上には入っている。迷ったが N-gram を眺めながら `/o/` に配置する。
    * 確定: `/o/` => `が`
* `さ` => ランク 26。`う_さ_い - う_さ_ん` の流れが上には入っている。配置は後回し。
* `せ` => ランク 30。`ん_せ_い - う_せ_ん` の流れが上には入っている。`/z/` か `/x/` か `/e/` が候補だったが、`/e/` が `し` に割り当てられたことで `/x/` に決定。
    * 確定: `/x/` => `せ`
* `け` => ランク 37。`ん_け_い - い_け_ん` の流れが上には入っている。配置は後回し。


それから今まで個人的にタイプしてきて良いと思った (つまり個人的な好みの) 配置をしていく。

* 確定: `/q/` => `ー`
* 確定: `/g/` => `っ`

これまでの決めてきたこと (といってもまた後で覆るかも知れないけれど) をまとめると以下のようになるだろうか。

```
ー と し __ __      __ __ こ が __
の シ か ん っ      __ う い シ シ
__ せ __ __ __      た __ __ 。 __
```

### てにをはを考える

ここらで気になるのがテニヲハの存在である。これらは文節の最後に来るという特徴を持つため、可能ならば単打面に入れたいという思いがある。uni-gram のランクを見ると、それぞれ `15, 10, 31, 17` である。これらランク的にも単打面に入れておく文字の様に見える (`を` は若干微妙だけど)。例に寄って tri-gram と bi-gram を見ながらそれぞれの配置を考えていく。

* 確定: `/h/` => `て`
* 確定: `/,/` => `に`
* 確定: `/b/` => `を`
* 確定: `/p/` => `は`

```
ー と し __ __      __ __ こ が は
の シ か ん っ      て う い シ シ
__ せ __ __ を      た __ に 。 __
```


### 人差し指に置かれる文字

上で `ん` と `う` がホームポジションの人差し指に置かれたが、(またしても新下駄配列のアプローチと同じ様に) 比較的頻出している文字で、`(ん|う)` とはあまりつながっていない文字を探してみる。

`(ん|う)` の前後に現れる回数が比較的少ない文字は、それぞれ以下のようになる。

* ん <=>
    * く、る、っ、**つ**、**ち**
* う <=>
    * く、る、っ、**ら**、**れ**

となる。この中で uni-gram 的に高ランクなものは `く る っ つ` である。少し考えて以下のような配置を行う。

* 確定: `/u/` => `く`
* 確定: `/t/` => `つ`
* 確定: `/v/` => `る`

```
ー と し __ つ      __ く こ が は
の シ か ん っ      て う い シ シ
__ せ __ る を      た __ に 。 __
```

### その他の高ランク文字

単打面もある程度出来上がってきたので、ここまで注目されていなかった高ランク文字を配置していく。今の所まだ考えられていないのは以下のものだろうか (一段目と二段目はランク 30 で分けている):

```
、 き じ な で さ す り ち せ
ま も ら お
```

`、` はある意味特殊な文字と見なすことができる。ここは新下駄配列にと同じような配置を行おうと思う。

* 確定: `/r/` => `、`

他にも N-gram を見ながら配置していく。

* 確定: `///` => `な`
* 確定: `/z/` => `す`
* 確定: `/c/` => `ま`
* 確定: `/m/` => `で`

* 再確定: `/y/` => `く` (`/u/` だった)
* 確定: `/u/` => `じ`

```
ー と し 、 つ      く じ こ が は
の シ か ん っ      て う い シ シ
す せ ま る を      た で に 。 な
```

これで一応単打面ができたことになる。


