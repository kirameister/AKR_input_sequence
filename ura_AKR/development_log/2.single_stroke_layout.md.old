# 実際の配列を決めていく

さて、裏 AKR 配列に関する大まかな方向性が定まり、配列を決めるときの鍵となるような N-gram のデータも揃った。ようやく配列を決めていくことにする。

### どれほどのストロークが減らせるのか

最初にローマ字入力と比較して、どれほどストロークが減らせるのか計算してみようと思う。幸い uni-gram のデータは既にあるので、そのデータを 2 つコピーして…

1. 本来キーボード三段で入力できない文字 (例えば `/=/` とか) やアルファベットなどの文字の行を削除。
2. 裏 AKR 配列用のデータでは、最初の 27 行まで `[tab]1` のカラムを追加、それ以降は `[tab]2` とする。これはその文字の入力に求められるキーストロークの数を表している。
3. ローマ字入力用のデータでは、各々の文字を見ながら入力に最低限必要だと思われるストローク数を書き込んでいく。例えば `ふぁ` であれば `[tab]2` であり、`っ` なら `[tab]1` である。
4. カラム 1 とカラム 3 を掛け合わせた全ての行の合計をそれぞれのファイルに求め、`裏 AKR 配列 / ローマ字入力` の数値を求める。

結果は、ローマ字入力で `ん` の入力に必要なストロークが 2 の場合は `71.99586 %`、必要なストロークが 1 の場合は `74.46763 %` という結果になった。

これはつまり、ストローク数だけ見れば、平均して 25% 程度は (ローマ字入力と比べて) 削減できることが見込まれることを表している。あとはどれだけ打つのが楽な配列を作成することができるかという話になるのだが、幸先が良い数値である。

### 最も重要な３つの文字

uni-gram のデータを見ると、(新下駄配列でもそうであったように) `い`、`う`、`ん` の三文字が圧倒的に多く出現しているのが分かる (次は `か` だが、頻度で言えば `ん` の 6 割程度だ)。

```
123035  い
120161  う
106997  ん
62282   か
...
```

ところで私は拗音のシフトキーを右手小指にしようと考えている。つまり `きょう` や `じゅう` という文字列を打つ場合、右手小指からスタートすることになる。仮に `う` のキーを左手に置いた場合、その前のキーが左手にある場合アルペジオを考えなければならないということになる。従って `う` に対応するキーは右手側に置いたほうが良いということになる。

これら３つの文字は、当然単打面の一番打ちやすい場所に配置されるが、bi-gram データを見ると、`うい` が `いう` よりも大分多く現れている。これって私の直感に大分反している気がする。bi-gram の元データを見ると「じゅういち」や「にじゅういち」というデータを見かける。なるほどこれらが合わさって `うい` に重みがついているのか。そして `い` から始まる bi-gram と `う` から始まるそれを比較すると、後者のほうが少しだけ頻繁にあるように見える。ここは私の個人的な直感を優先させて `いう` の方が優勢であるとして

* `/j/` => `う`
* `/k/` => `い`
* `/f/` => `ん`

とする (つまり新下駄配列と同じである)。

それから `ん` であるが、`/f/` ではなくて `/r/` でも良いのではないかと迷いはした (文頭や文節の最初には来ない文字のため)。しかし `ん` が中に来る単語も多いため (`かんがえ` や `さんじゅう` など)、`/f/` が良いだろうと判断した。

### tri-gram を使った考察

今の所確定しているのは `う`、`い`、`ん` の三文字しかないのだが、この辺で早速 tri-gram を見ていくことにしよう。早速超上位ランクに以下のような流れがある:

```
5585    う_せ_い
5096    い_せ_い
..
3380    ん_せ_い
```

`う|い` は既に右手単打面のホームポジションにあるため、間に入る `せ` も単打面が良いということになる。`せ` は uni-gram 的には 25 番目にある文字である。これらのことから `せ` は左手の小指-中指のキーに配置されるべきであると考える (今のところの個人的な感覚は `/z/` か `/x/` か `/e/` なのだけれどまだ決定的ではない)。

それから以下のような tri-gram も (高ランクの場所に) ある:

```
5682    る_。_〓
...
4830    て_い_る
```

更に以下のような 4-gram も 20 番のランクにある:

```
2091    い_る_。_〓 
```

`て` の場所はまた考えるとして、`い` の次には `る。` が来ることが多いことが分かる。ところで `う_。` の bi-gram ランクは 372 で、`い_。` のそれは 254 である。ここから `る` は左手のキーのどれか、`。` は `/./` に配置するのが妥当だと考える。

他にも tri-gram には以下の行がある (ランク 39):

```
2701    ん_た_い
```

ちなみに `た` は uni-gram ランク 9 である。ここは `たい` のアルペジオを意識して `/o/` か `/n/` に配置するのが妥当だと考えるが、`。` のことも考えて `/n/` に配置する (`た。` はアルペジオで表現したい上にキーボードによっては `/m/` だと `/k/` とのアルペジオがタイトすぎることがある)。

...この辺で一々自分の思考を文にするのが疲れてきた。他にも高ランクの tri-gram で `(い|う|ん)` のうち二文字が含まれているものには以下のようなものがある (拗音の入ったものは今はまだ考えない)。ちなみにこれらは全てトップ 100 ランクまでのものだが、それだけでもこれだけの数があるということである。

```
4134    う_ほ_う
3692    ん_こ_う
3476    ん_け_い
3474    ん_と_う
3380    ん_せ_い
3254    う_か_い
3197    う_こ_う
2990    う_ど_う
2985    い_こ_う
2950    ん_だ_い
2775    う_が_い
2757    ん_か_い
2743    う_し_ん
2710    い_と_う
2706    う_か_ん
2666    う_さ_い
2653    ん_か_ん
2599    い_し_ん
2543    い_が_い
2534    い_け_ん
2466    う_ね_ん
2362    ん_ざ_い
2345    と_い_う
2335    う_さ_ん
2329    ん_ね_ん
2128    う_よ_う
2043    う_せ_ん
2002    う_と_う
1956    う_そ_う
```

ここから以下のように考えていく (uni-gram ランクの高い順にソートしている):

* `か` => ランク 4。`う_か_い - ん_か_い - う_か_ん - ん_か_ん` の流れが上には入っている。ランク 4 ということ `ん` とのアルペジオを考えて `/d/` に配置。
* `と` => ランク 6。`ん_と_う - い_と_う - と_い_う - う_と_う` の流れが上には入っている。本来ならば新下駄配列のように `/s/` に配置したいところだが、それはシフトキーなので `/w/` が妥当であると考える。
* `し` => ランク 7。`う_し_ん - い_し_ん` の流れが上には入っている。`/p/` というのも考えたが、それでは小指を酷使することになりそうなので `/e/` とする。
* `こ` => ランク 13。`ん_こ_う - う_こ_う - い_こ_う` の流れが上には入っている。4-gram を見てみると `(け|か|じ|し|さ|へ)_ん_こ_う` が上位にある。bi-gram では `こ_い` というのがあまり上位になかったので、`/i/` に配置。
* `が` => ランク 15。`う_が_い - い_が_い` の流れが上には入っている。迷ったが N-gram を眺めながら `/o/` に配置する。
* `さ` => ランク 22。`う_さ_い - う_さ_ん` の流れが上には入っている。配置は後回し。
* `せ` => ランク 25。`ん_せ_い - う_せ_ん` の流れが上には入っている。`/z/` か `/x/` か `/e/` が候補だったが、`/e/` が `し` に割り当てられたことで `/x/` に決定。
* `け` => ランク 33。`ん_け_い - い_け_ん` の流れが上には入っている。配置は後回し。
* `だ` => ランク 35。`ん_だ_い` の流れが上には入っている。配置は後回し。
* `よ` => ランク 37。`う_よ_う` の流れが上には入っている。配置は後回し。
* `ど` => ランク 39。`う_ど_う` の流れが上には入っている。配置は後回し。
* `そ` => ランク 41。`う_そ_う` の流れが上には入っている。配置は後回し。
* `ほ` => ランク 48。`う_ほ_う` の流れが上には入っている。配置は後回し。
* `ね` => ランク 52。`う_ね_ん - ん_ね_ん` の流れが上には入っている。配置は後回し。
* `ざ` => ランク 73。`ん_ざ_い` の流れが上には入っている。配置は後回し。


これまでの決めてきたこと (といってもまた後で覆るかも知れないけれど) をまとめると以下のようになるだろうか。

```
__ と し __ __      __ __ こ が __
__ シ か ん __      __ う い シ シ
__ せ __ __ __      た __ __ 。 __
```

### てにをはを考える

ここらで気になるのがテニヲハの存在である。これらは文節の最後に来るという特徴を持つため、可能ならば単打面に入れたいという思いがある。uni-gram のランクを見ると、それぞれ `12, 10, 26, 14` である。これらランク的にも単打面に入れておく文字の様に見える。例に寄って tri-gram と bi-gram を見ながらそれぞれの配置を考えていく。

```
4960	に_じゅ_う
3847	に_っ_ぽ
2553	じゅ_う_に
2407	に_せ_ん
2344	よ_う_に
2061	に_た_い
---
6864	う_に
5762	に_ん
5456	ん_に
3990	い_に
3932	く_に
```

仮配置と言えなくもないが、`/,/` にしておく。

```
4830	て_い_る
3745	っ_て_い
3098	し_て_い
1859	て_き_な
1831	と_し_て
1559	て_い_た
1554	て_き_に
---
15747	て_い
8443	し_て
8287	っ_て
7661	て_き
4992	て_ん
4619	い_て
```

...`/h/` かな。

```
1746	は_じ_め
1575	か_い_は
1346	い_は_つ
1265	は_な_し
1208	じゅ_う_は
---
6033	は_、
4820	は_ん
3698	は_い
3646	う_は
3272	い_は
```

...`/q/` かな。

```
1440	こ_と_を
1394	を_お_こ
1004	せ_い_を
---
3463	ん_を
3328	う_を
2557	い_を
1671	を_か
1596	を_お
```

...`/b/` かな。

てにをはを加えた今までのところの単打配置は以下のようになる。

```
は と し __ __      __ __ こ が __
__ シ か ん __      て う い シ シ
__ せ __ __ を      た __ に 。 __
```


### 人差し指に置かれる文字

上で `ん` と `う` がホームポジションの人差し指に置かれたが、(またしても新下駄配列のアプローチと同じ様に) 比較的頻出している文字で、`(ん|う)` とはあまりつながっていない文字を探してみる。bi-gram からは以下のようなデータが得られる (`===` がカラムの区切りで、一番左のカラムは uni-gram から得られたデータ):

```
62282  か === 18866   か_ん - 7462    ん_か     ===     363     か_う - 8417    う_か
58867  の === 110     の_ん - 6556    ん_の     ===     4748    の_う - 6125    う_の
50846  と === 728     と_ん - 5676    ん_と     ===     14596   と_う - 3870    う_と
50801  し === 12427   し_ん - 4656    ん_し     ===     52      し_う - 8155    う_し
50010  く === 672     く_ん - 493     ん_く     ===     790     く_う - 520     う_く
49247  た === 2714    た_ん - 3688    ん_た     ===     205     た_う - 2226    う_た
46103  に === 5762    に_ん - 5456    ん_に     ===     311     に_う - 6864    う_に
43097  、 === 2       、_ん - 1517    ん_、     ===     356     、_う - 1433    う_、
37801  て === 4992    て_ん - 2826    ん_て     ===     123     て_う - 1695    う_て
36644  こ === 4351    こ_ん - 3991    ん_こ     ===     21067   こ_う - 4023    う_こ
36457  は === 4820    は_ん - 2735    ん_は     ===     374     は_う - 3646    う_は
35940  が === 893     が_ん - 5774    ん_が     ===     400     が_う - 5707    う_が
35825  な === 2674    な_ん - 3443    ん_な     ===     593     な_う - 3117    う_な
34435  る === 263     る_ん - 246     ん_る     ===     153     る_う - 244     う_る
30602  き === 4727    き_ん - 1970    ん_き     ===     128     き_う - 2258    う_き
30274  。 === 0       。_ん - 1174    ん_。     ===     11      。_う - 1606    う_。
28931  っ === 2       っ_ん - 35      ん_っ     ===     8       っ_う - 268     う_っ
28347  つ === 29      つ_ん - 373     ん_つ     ===     2669    つ_う - 1313    う_つ
27451  さ === 13578   さ_ん - 2525    ん_さ     ===     140     さ_う - 5239    う_さ
27373  す === 229     す_ん - 2842    ん_す     ===     2168    す_う - 2214    う_す
27211  で === 2345    で_ん - 3936    ん_で     ===     139     で_う - 2832    う_で
25395  せ === 12979   せ_ん - 4004    ん_せ     ===     7       せ_う - 5206    う_せ
24957  を === 0       を_ん - 3463    ん_を     ===     898     を_う - 3328    う_を
22254  ま === 2881    ま_ん - 858     ん_ま     ===     250     ま_う - 1159    う_ま
21819  も === 3497    も_ん - 1415    ん_も     ===     1530    も_う - 1274    う_も
21367  り === 1896    り_ん - 1915    ん_り     ===     119     り_う - 2158    う_り
20693  ら === 2224    ら_ん - 739     ん_ら     ===     356     ら_う - 961     う_ら
20482  お === 1404    お_ん - 317     ん_お     ===     2448    お_う - 931     う_お
20296  あ === 3023    あ_ん - 450     ん_あ     ===     206     あ_う - 363     う_あ
19873  け === 11916   け_ん - 3109    ん_け     ===     25      け_う - 3466    う_け
18435  じ === 4744    じ_ん - 3211    ん_じ     ===     50      じ_う - 3918    う_じ
18244  だ === 4869    だ_ん - 4137    ん_だ     ===     91      だ_う - 2170    う_だ
18017  れ === 2805    れ_ん - 1103    ん_れ     ===     12      れ_う - 895     う_れ
17589  よ === 3184    よ_ん - 1115    ん_よ     ===     14898   よ_う - 2468    う_よ
17200  ち === 536     ち_ん - 951     ん_ち     ===     46      ち_う - 2458    う_ち
16433  ど === 566     ど_ん - 3757    ん_ど     ===     11915   ど_う - 2506    う_ど
```

上の表から、`(ん|う)` の前後に現れる回数が前後とも三桁以下の文字は、それぞれ:
* ん <=>
    * く、る、っ、**つ**、**ち**
* う <=>
    * く、る、っ、**ら**、**れ**

となる。この中で uni-gram 的に高ランクなものは `く る っ つ` である。少し考えて以下のような配置を行う。


```
は と し __ つ      __ く こ が __
__ シ か ん っ      て う い シ シ
__ せ __ る を      た __ に 。 __
```

### その他の高ランク文字

単打面もある程度出来上がってきたので、ここまで注目されていなかった高ランク文字を配置していく。今の所まだ考えられていないのは以下のものだろうか (一段目と二段目はランク 27 で分けている):

```
の 、 な き さ す で ま
も り ら
```

`の` と `、` はある意味特殊な文字と見なすことができる。ここは新下駄配列にと同じような配置を行おうと思う。

それ以外の文字を上から考えていく。

```
3213	お_こ_な
2066	よ_う_な
---
8027	な_い
5037	な_ど
3966	な_か
3443	ん_な
3174	は_な
3117	う_な
2674	な_ん
2356	な_が
2315	こ_な
2290	な_な
2256	く_な
2202	に_な
2177	な_っ
2145	き_な
```

...`/p/` かな。

```
2012	き_ぎょ_う
---
7661	て_き
5442	い_き
4727	き_ん
3313	で_き
2708	し_き
2371	き_か
2339	き_た
2320	き_に
```

す
```
3613	す_。_〓
2590	ん_す_る
2242	う_す_る
2108	い_す_る
2001	ま_す_。
---
12539	す_る
3804	す_。
3776	で_す
3496	ま_す
3368	す_い
2842	ん_す
2214	う_す
2168	す_う
```

で
```
---
3936	ん_で
3776	で_す
3313	で_き
2986	い_で
2834	の_で
2832	う_で
2784	で_は
2758	ま_で
2641	で_あ
2365	で_、
2345	で_ん
```

ま
```
2001	ま_す_。
---
3496	ま_す
3352	い_ま
2881	ま_ん
2758	ま_で
2633	し_ま
2218	ま_た
```

これらを上から当てはめていくと以下のような感じになる。

```
は と し 、 つ      __ く こ が な
の シ か ん っ      て う い シ シ
す せ ま る を      た で に 。 __
```

### 長母音

長母音そのものは uni-gram ランクで 43 なのだが、長母音から始まる単語や文節というのは存在しない。つまりこれも単打面に置くべきだと考えるのだけれど、`/y/` と `///` のどちらに置くか悩むところである。例によってデータを見ていく。

```
1314	ん_た_ー
631	さ_ー_び
631	ー_び_す
---
1881	ー_と
1835	た_ー
1742	ー_る
1329	り_ー
971	ー_す
```

...うーん、どちらがよいかわからない。どちらもありえると思うのだけれど、今は `/y/` か `///` のどちらかということで保留にしてても良いかも。

というわけで、現状単打面はこのようなかたちでまとまった:

```
は と し 、 つ      Ａ く こ が な
の シ か ん っ      て う い シ シ
す せ ま る を      た で に 。 Ａ

Ａ: ー
```


